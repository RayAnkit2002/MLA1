---
title: "2327510_AnkitRay_MLA1"
author: "Ankit Ray"
date: "`r Sys.Date()`"
output:
  word_document: default
  html_document: default
  pdf_document: default
---


```{r}
# Load necessary libraries
library(ggplot2)
library(reshape2)
library(caret)
library(dplyr)
library(glmnet)

# Load the dataset
df <- read.csv("C:/Users/ankit/Desktop/insurance data.csv")

# View the first few rows of the dataset
head(df)

# View the structure of the dataset
str(df)

# Summary statistics for the dataset
summary(df)
```
```{r}
library(DataExplorer)
library(ggplot2)
plot_density(df)
```
```{r}
plot_histogram(df)
```

```{r}

# Check for missing values
missing_values <- colSums(is.na(df))
print(missing_values)

# Select numeric columns for correlation matrix
numeric_columns <- df[, c("age", "bmi", "children", "charges")]

# Create the correlation matrix
correlation_matrix <- cor(numeric_columns)

# Melt the correlation matrix for ggplot2
melted_correlation <- melt(correlation_matrix)

# Create the heatmap
heatmap <- ggplot(data = melted_correlation, aes(x = Var1, y = Var2, fill = value)) +
  geom_tile(color = "white")

# Show the heatmap
print(heatmap)

# Scatter plot of Age vs Charges
ggplot(df, aes(x = age, y = charges)) +
  geom_point() +
  labs(x = "Age", y = "Charges", title = "Scatter plot of Age vs Charges")

# Histogram of Charges
ggplot(df, aes(x = charges)) +
  geom_histogram(binwidth = 1000, fill = "skyblue", color = "black") +
  labs(x = "Charges", y = "Frequency", title = "Distribution of Charges")

# Pie chart for Smoker
smoker_counts <- table(df$smoker)
pie(smoker_counts, labels = c("Non-Smoker", "Smoker"),
    col = c("skyblue", "salmon"),
    main = "Pie Chart of Smokers vs Non-Smokers")

# Bar chart for Region
region_counts <- table(df$region)
barplot(region_counts, col = "lightgreen",
        main = "Bar Chart of Counts by Region",
        xlab = "Region", ylab = "Count")

# Histogram of Charges by Age
ggplot(df, aes(x = age, fill = charges)) +
  geom_histogram(binwidth = 1, color = "black") +
  labs(x = "Age", y = "Frequency", title = "Distribution of Charges by Age")


```
```{r}
# MLR

# Convert categorical variables to factors if needed
df <- df %>%
  mutate(
    sex = as.factor(sex),
    smoker = as.factor(smoker),
    region = as.factor(region)
  )

# Check the structure of your data
str(df)

# Fit the Multiple Linear Regression model
mlr_model <- lm(charges ~ age + sex + bmi + children + smoker + region, data = df)

# Summarize the model
summary(mlr_model)

# Extract R-squared (R2) value from the summary
mlr_r2 <- summary(mlr_model)$r.squared
print(mlr_r2)

# Predict on training data
mlr_predictions <- predict(mlr_model, newdata = df)

# Calculate Mean Squared Error (MSE) for the Multiple Linear Regression model
mlr_mse <- mean((df$charges - mlr_predictions)^2)
print(mlr_mse)
```

```{r}
# Lasso Regression

# Prepare the predictor matrix and response vector
X <- model.matrix(charges ~ age + sex + bmi + children + smoker + region, data = df)[, -1]
y <- df$charges

# Check the dimensions of X and y
print(dim(X))
print(length(y))

# Fit the Lasso regression model using glmnet
lasso_model <- glmnet(X, y, alpha = 1)  # alpha = 1 specifies Lasso regression

# Perform cross-validation to select lambda (regularization parameter)
cv_model <- cv.glmnet(X, y, alpha = 1)

# Print the cross-validation results
print(cv_model)

# Extract the best lambda value from cross-validation
best_lambda <- cv_model$lambda.min

# Refit the model with the best lambda
lasso_model_best <- glmnet(X, y, alpha = 1, lambda = best_lambda)

# Calculate R-squared (R2) value for the best model
lasso_r2 <- cor(y, predict(lasso_model_best, s = best_lambda, newx = X))^2
print(lasso_r2)

# Predict on training data with the best lambda
lasso_predictions <- predict(lasso_model_best, s = best_lambda, newx = X)

# Calculate Mean Squared Error (MSE) for the Lasso regression model
lasso_mse <- mean((y - lasso_predictions)^2)
print(lasso_mse)


```
```{r}
# Ridge Regression

# Fit the Ridge regression model using glmnet
ridge_model <- glmnet(X, y, alpha = 0)  # alpha = 0 specifies Ridge regression

# Perform cross-validation to select lambda (regularization parameter)
cv_model <- cv.glmnet(X, y, alpha = 0)

# Print the cross-validation results
print(cv_model)

# Extract the best lambda value from cross-validation
best_lambda <- cv_model$lambda.min

# Refit the model with the best lambda
ridge_model_best <- glmnet(X, y, alpha = 0, lambda = best_lambda)

# Calculate R-squared (R2) value for the best model
ridge_predictions <- predict(ridge_model_best, s = best_lambda, newx = X)
ridge_r2 <- cor(y, ridge_predictions)^2
print(ridge_r2)

# Calculate Mean Squared Error (MSE) for the Ridge regression model
ridge_mse <- mean((y - ridge_predictions)^2)
print(ridge_mse)


```